<div class="supreme-container">
<div class="banner-guide-board">
<%= @guide.name.upcase %>
</div>

<div id="map-guide" style="width: 100%; height: 72vh; position: center;"></div>

<%= render 'cards/form' %>

<div class="container">
<H4>YOUR PLACES (<%= @guide.cards.size %>)</H4>
  <div class="card-filters">
    <ul class="list-inline">
      <li>
        <%= link_to guide_path(@guide, category: "Eat"), remote: true do %>
          <i class="fa fa-cutlery fa-lg" aria-hidden="true"></i>
        <% end %>
      </li>
      <li>
        <i class="fa fa-bed fa-lg" aria-hidden="true"></i>
      </li>
      <li>
        <i class="fa fa-glass fa-lg" aria-hidden="true"></i>
      </li>
      <li>
        <i class="fa fa-shopping-bag fa-lg" aria-hidden="true"></i>
      </li>
      <li>
        <i class="fa fa-eye fa-lg" aria-hidden="true"></i>
      </li>
    </ul>
  </div>
  <div class="row" id="guide-cards">
    <%= render 'shared/cards', cards: @cards %>
  </div>
</div>
</div>

<%= render 'shared/modal' %>

<% content_for(:after_js) do %>
  <script>
    $(document).on('ready', function() {
      handler = Gmaps.build('Google');
      // handler.buildMap({ internal: { id: 'map-guide' } }, function(){
      //   markers = handler.addMarkers(<%= raw @markers.to_json %>);
      //   handler.bounds.extendWith(markers);
      //   handler.fitMapToBounds();
      // });
      //
      //

       handler.buildMap({
          provider: {
            scrollwheel: false,
            styles: mapStyle
          },
          internal: { id: 'map-guide' } }, function(){
          markers = handler.addMarkers(<%= raw @markersguide.to_json %>);
          handler.bounds.extendWith(markers);
          handler.fitMapToBounds();
         if (markers[0].serviceObject.title === "country") {
           handler.getMap().setZoom(6);
          } else if (markers[0].serviceObject.title === "administrative_area_level_1") {
           handler.getMap().setZoom(9);
          } else if (markers[0].serviceObject.title === "administrative_area_level_2") {
           handler.getMap().setZoom(10);
          } else {
            handler.getMap().setZoom(11);
          }
          markerscard = handler.addMarkers(<%= raw @markers.to_json %>);
          handler.bounds.extendWith(markerscard);
          if (markerscard.length === 0){
            markers = handler.removeMarkers(markers);
          } else {
            handler.fitMapToBounds();
            markers = handler.removeMarkers(markers);
          }
        });
      })

  </script>
<% end %>
